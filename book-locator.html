<!DOCTYPE html>

<html>
<head>
    <meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" />
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.css" />
	<link rel="stylesheet" type="text/css" href="langsdale-on-the-go.css" />
	<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
	<script>
		$( window.document ).bind('mobileinit', function(){
			$("[data-role=header]").fixedtoolbar({ disablePageZoom: false });
			$("[data-role=header]").fixedtoolbar({ hideDuringFocus: "input, select, textarea" });
		});
	</script>
	<script src="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.js"></script>
	<script src="js/call_number_normalizer.js"></script>
	<script src="js/langsdale_mobile.js"></script>
    <title>UB Book Locator</title>
</head>
<body id="myBodyPage">
	<div data-role="page" id="index">

		<div data-role="header" data-position="fixed" id="my_header" >
			<a href="index.html" data-role="button" data-inline="true" data-icon="arrow-l" data-ajax="false">Back</a>
			<h1>UB Book Locator</h1>
		</div><!-- /header -->

		<div data-role="content">
			<div id="mainMenu">
			<form>
				<input type="search" id="callNumber" placeholder="Enter your call number" />
		        <input type="button" id="findBook" value="Find this Book" />
		        <span id="message"></span>
		    </form>
		    <div id="mapWrapper" class="full_canvas">
		        <canvas id="myMap" width="450" height="450" class="full_canvas"></canvas>
		        <small>3rd Floor Map</small>
		    </div>
			<div id="loading"><img src="images/ajax-loader.gif" /></div>
			</div>
		</div><!-- /content -->
		
		<div data-role="footer" data-position="fixed" id="myFooter">
			<div data-role="navbar">
				<ul>
					<li><a href="index.html" data-icon="home" class="ui-btn-active" data-ajax="false">Home</a></li>
					<li><a href="http://langsdale.ubalt.edu" data-icon="grid" data-ajax="false">Full site</a></li> 
				</ul>
			</div><!-- /navbar -->
		</div><!-- /footer -->

	</div><!-- /page -->
	<script>
		// BOOK LOCATOR
		
		//load data from web service
		var source = "json/langsdale_sections.json";
		var xmlhttp = new XMLHttpRequest();
		xmlhttp.open("GET",source,false);
		xmlhttp.send("");
		sections = JSON.parse(xmlhttp.responseText);

		// inspect find button
		var findBook = document.getElementById("findBook");
		findBook.onclick = findTheBook;

		function findTheBook() { // evaluate the textbox, find and display the stack
		    // get call number from textbox
		    var callNumber = document.getElementById("callNumber").value;
		    var callNumber = callNumber.toUpperCase();
		    document.getElementById("callNumber").value = callNumber;
		    //alert(normalizeLC(callNumber));
		    var inStock = function(callNumber) {
		        foundBook = false;
		        for (var i=0; i < sections.length; i++) { 
		            var beginSection = sections[i].begin, endSection = sections[i].end, book = callNumber;
		            if (normalizeLC(book) >= normalizeLC(beginSection) && normalizeLC(book) <= normalizeLC(endSection)) {
		                //alert(" book: "+normalizeLC(book)+" / begin: "+normalizeLC(beginSection)+" / end: "+normalizeLC(endSection));
		                sectionFound = sections[i];
		                foundBook = true;
		            }
		        }
		        return foundBook;
		    }
		    var inStock = inStock(callNumber);
		    if (inStock == true) {
		        // only if the call number was found
		        sectionLocationX = sectionFound.location_x;
		        sectionLocationY = sectionFound.location_y;
		        sectionSizeW = sectionFound.size_w;
		        sectionSizeH = sectionFound.size_h;
		        // show canvas wrapper and message
		        document.getElementById('myBodyPage').scrollIntoView();
		        document.getElementById("mapWrapper").style.display = "none";
		        document.getElementById("loading").style.display = "block";
		        setTimeout(function() {
		            document.getElementById("loading").style.display = "none";                
		            document.getElementById("mapWrapper").style.display = "block";                
		            // iniciate canvas 
		            var myMap=document.getElementById("myMap");
		            var ctx=myMap.getContext("2d");
		            // iniciate PNG map
		            var imageMap=new Image();
		            // display map
		            imageMap.src = "images/book_locator_map.gif";
		            imageMap.onload = function() {
		                ctx.drawImage(imageMap,0,0);
		                ctx.fillStyle = "#FFFF00"; // yellow
		                ctx.fillRect(sectionLocationX-7,sectionLocationY,sectionSizeW+14,sectionSizeH);
		                ctx.fillStyle = "#990000"; // red
		                ctx.fillRect(sectionLocationX,sectionLocationY,sectionSizeW,sectionSizeH);
		                ctx.font="bold 8pt Arial";
		                ctx.fillStyle="#FFFFFF"; //white
		                ctx.textAlign="center";
		                ctx.fillText(sectionFound.section,sectionLocationX+(sectionSizeW/2),sectionLocationY+8);
		                ctx.font="normal 13pt Monotype";
		                ctx.fillStyle="#990000"; // red
		                ctx.textAlign="center";
		                ctx.fillText(callNumber,225,230);
		                ctx.font="normal 10pt Arial";
		                ctx.fillText("Find your book in",225,252);
		                ctx.fillText("SECTION: "+sectionFound.section,225,275);
		            };
		        },600);
		    }
		    if (inStock == false) { // only if the call number wasn't found
		        document.getElementById("mapWrapper").style.display = "none";
		    }
		}
	</script>
</body>
</html>

    		
